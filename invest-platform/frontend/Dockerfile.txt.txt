# ============== 构建阶段 ==============
FROM node:22-alpine AS builder

# 设置工作目录
WORKDIR /app

# 优先复制 package.json 和 package-lock.json (利用 Docker 缓存层)
COPY package.json package-lock.json* ./

# 安装依赖 (使用 ci 更快更严格)
RUN npm ci

# 复制所有源代码
COPY . .

# 构建生产环境代码
RUN npm run build

# ============== 运行阶段 ==============
# 使用 Zeabur 推荐的静态文件服务器
FROM zeabur/caddy-static:latest

# 将构建产物 (dist 目录) 复制到 Caddy 的服务目录
COPY --from=builder /app/dist /srv
